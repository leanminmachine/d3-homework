<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Line Chart</title>
  <link rel="stylesheet" href="/vendor/normalize.css">
  <style>
  .y-label {
    fill: #000;
    font-size: 10;
    font-weight: bold;
    text-anchor: start;
  }

  .line1 {
    fill: none;
    /*stroke: red;*/
    stroke-width: 1.5px;
    stroke-linejoin: round;
    stroke-linecap:round;
  }

  .line2 {
    fill: none;
    /*stroke: blue;*/
    stroke-width: 1.5px;
    stroke-linejoin: round;
    stroke-linecap:round;
  }

  .line3 {
    fill: none;
    /*stroke: yellow;*/
    stroke-width: 1.5px;
    stroke-linejoin: round;
    stroke-linecap:round;
  }

  .line4 {
    fill: none;
    stroke: green;
    stroke-width: 1.5px;
    stroke-linejoin: round;
    stroke-linecap:round;
  }

  .line5 {
    fill: none;
    stroke: orange;
    stroke-width: 1.5px;
    stroke-linejoin: round;
    stroke-linecap:round;
  }

  .line6 {
    fill: none;
    stroke: brown;
    stroke-width: 1.5px;
    stroke-linejoin: round;
    stroke-linecap:round;
  }

  .line7 {
    fill: none;
    stroke: purple;
    stroke-width: 1.5px;
    stroke-linejoin: round;
    stroke-linecap:round;
  }

  .grid line{
    fill: none;
    stroke: #dfdfdf;
    stroke-width: 1px;
  }

  .dot {
    fill: #ffab00;
    stroke: #fff;
  }

  .legend {
    font-size: 12px;
  }

  rect {
    stroke-width: 2;
  }

  </style>
</head>
<body>


  <div style="margin:50px; display:flex; flex-direction: column; align-content:center">
    <h3 style="text-align:center">Line Chart of Mobile Subscription</h3>
    <div id="chart" style="margin:auto;display:block;"></div>
  </div>


  <script src="/vendor/d3.min.js"></script>
  <script>

  //Line Chart Checklist

// Add an SVG to draw our line chart on
// Use the D3 standard margin convetion
// Create an x axis
// Create a y axis
// Create an x scale
// Create a y scale
// Create a line generator
// Create a random dataset
// Create a path object for the line
// Bind the data to the path object
// Call the line generator on the data-bound path object
// Add circles to show each datapoint
// Add some basic styling to the chart so its easier on the eyes

  //Define the dimensions of the bar diagram

  var margin = {top: 30, right: 20, bottom: 30, left: 50};
  var width = 900 - margin.left - margin.right;
  var height = 450 - margin.top - margin.bottom;

  var color = d3.scaleOrdinal(d3.schemeCategory20b);

  //parser to handle time data
  var parseTime = d3.timeParse("%Y");

  //create the bar graph svg
  var svg = d3.select("#chart")
  .append("svg")
  .attr('width', width+60)
  .attr('height', height+50)
  .call(d3.zoom().on("zoom", function () {
              svg.attr("transform", d3.event.transform)
      }))
  .append("g")
  .attr("transform", "translate(" + 40 + "," + 20 + ")");

  //get data from csv
  d3.csv("/data/online-shoppers-by-age-group.csv", function(d) {
    //clean data, + operator is used for type conversion
    // d.month = parseTime(d.month);
    // d.total = +d.total;
      d.year = parseTime(d.year);
      d["less than 7"] = +d["less than 7"];
      d["8 to 14 years"] = +d["8 to 14 years"];
      d["15 to 24 years"] = +d["15 to 24 years"];
      d["25 to 34 years"] = +d["25 to 34 years"];
      d["35 to 49 years"] = +d["35 to 49 years"];
      d["50 to 59 years"] = +d["59 to 59 years"];
      d["60 and above"] = +d["60 and above"];

    console.log(d);
    return d;
  }, function(error, dataset) {
    //callback function is the data read is successful

    if (error) throw error;

    //define the axises' scale types and values

    var x = d3.scaleTime()
    .domain(d3.extent(dataset, function(d) { return d.year; })) //returns min and max range
    .rangeRound([0, width]);

    // max is 100% !!!
    var y = d3.scaleLinear()
    .domain([0, 100])
    .rangeRound([height, 0]);


    //bind data to line -> d3.line generates lines
    var lineLessThan7 = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d["less than 7"]) })


    var line8to14 = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d["8 to 14 years"]) })

    var line15to24 = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d["15 to 24 years"]) })

    var line25to34 = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d["25 to 34 years"]) })

    var line35to49 = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d["35 to 49 years"]) })

    var line50to59 = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d["50 to 59 years"]) })

    var line60 = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d["60 and above"]) })

    var legendRectSize = 18;
    var legendSpacing = 4;
    var color = d3.scaleOrdinal(d3.schemeCategory20b);

    //add grid line
    svg.append("g")
    .call(d3.axisLeft(y).ticks(10).tickSize(-width).tickFormat(""))
    .attr("class", "grid");


    //draw line
    svg.append("path")
    .datum(dataset)
    .attr("class", "line1") //to add the css CLASS called line, will overwrite custom styles you define in attr
    .attr("d", lineLessThan7); //d -> data

    svg.append("path")
    .datum(dataset)
    .attr("class", "line2")
    .attr("d", line8to14);

    svg.append("path")
    .datum(dataset)
    .attr("class", "line3")
    .attr("d", line15to24);

    svg.append("path")
    .datum(dataset)
    .attr("class", "line4")
    .attr("d", line25to34);

    svg.append("path")
    .datum(dataset)
    .attr("class", "line5")
    .attr("d", line35to49);

    svg.append("path")
    .datum(dataset)
    .attr("class", "line6")
    .attr("d", line50to59);

    svg.append("path")
    .datum(dataset)
    .attr("class", "line7")
    .attr("d", line60);


    //draw x-axis
    svg.append("g")
    .attr("class", "axis x-axis")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x));


    //draw the y-axis
    svg.append("g")
    .attr("class", "axis")
    .call(d3.axisLeft(y).ticks(null, "s"))

    // 12. Appends a circle for each datapoint
    // svg.selectAll(".dot")
    // .data(dataset)
    // .enter().append("circle") // Uses the enter().append() method
    // .attr("class", "dot") // Assign a class for styling
    // .attr("cx", function(d) { return x(d.year) })
    // .attr("cy", function(d) { return y(d["35 to 49 years"]) })
    // .attr("r", 8);


    //write the y-axis label
    svg.append("text")
    .attr("x", 5)
    .attr("y", -10)
    .attr("dy", "0.32em") //dy is relative coordinates - while y is absolute
    .attr("class", "y-label")
    .text("Percentage (%)");


    var legend = svg.selectAll('.legend')
    .data(dataset)
    .enter
    .append('g')
    .attr('class', 'legend');

    legend.append('text')
    .attr('x', 200)
    .attr('y', 200)
    .text(function(d) { return d });

    });


  </script>
</body>
</html>
